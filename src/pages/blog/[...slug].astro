---
import { type CollectionEntry, getCollection } from "astro:content";
import BlogPost from "../../layouts/BlogPost.astro";
export const prerender = true;
import { render } from "astro:content";

export async function getStaticPaths() {
  try {
    const posts = await getCollection("blog");
    return posts.map((post) => ({
      params: { slug: post.id },
      props: post,
    }));
  } catch (error) {
    console.error("Error fetching blog posts:", error);
    return [];
  }
}

type Props = CollectionEntry<"blog">;

const post = Astro.props;

if (!post || !post.data) {
  console.error("Invalid post data:", post);
  throw new Error("Blog post data is missing or corrupted.");
}

const { Content } = await render(post).catch((error) => {
  console.error("Error rendering content:", error);
  return { Content: null };
});

// Ensure required props have fallback values
const postData = {
  title: post.data.title ?? "Untitled Post",
  description: post.data.description ?? "No description available.",
  pubDate: post.data.pubDate ?? new Date(0), // Default to Unix epoch if missing
};
---

<BlogPost {...postData}>
  {Content ? <Content /> : <p style="color:red;">Content not found</p>}
</BlogPost>
